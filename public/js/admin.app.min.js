"use strict";function passwordVerify(){function e(e,r,t,n){e.$watch(function(){var r;return(e.passwordVerify||n)&&(r=e.passwordVerify+"_"+n),r},function(r){r&&(n.$validators.passwordVerify=function(r){var t=e.passwordVerify;return t===r})})}var r={require:"ngModel",scope:{passwordVerify:"="},link:e};return r}angular.module("myAdmin",["ngMaterial","ngAnimate","ngSanitize","app.routes","app.config","app.controllers","app.directives","app.factories","app.filters","ngMessages","LocalStorageModule","ui.bootstrap","pouchdb","md.data.table"]),angular.module("app.controllers",[]),angular.module("app.factories",[]),angular.module("app.directives",[]),angular.module("app.filters",[]),angular.module("app.config",["LocalStorageModule"]).config(["$httpProvider",function(e){var r=["$q","localStorageService","AuthSrv","$location","$rootScope",function(e,r,t,n,o){return{request:function(e){e.headers=e.headers||{};var n=r.get("token");return n&&(e.headers.Authorization="Bearer "+n,t.isLogged=1),e},requestError:function(r){return e.reject(r)},response:function(r){return r||e.when(r)},responseError:function(a){return 401===a.status&&void 0!==a.data.errors.code&&(o.$broadcast("TokenExpiredError",{message:"Session has been expired, please login again."}),r.remove("token"),r.remove("admin"),delete o.admin,t.isLogged=!1,n.path("/")),e.reject(a)}}}];e.interceptors.push(r)}]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("deep-purple").accentPalette("deep-purple"),e.enableBrowserColor({theme:"blue",palette:"blue",hue:"800"})}]).config(["localStorageServiceProvider",function(e){e.setPrefix("admin")}]).run(["$location","$rootScope","$window","localStorageService","AuthSrv","toastService",function(e,r,t,n,o,a){function s(){console.log("found new version!"),t.applicationCache.update()}t.applicationCache.addEventListener("updateready",s),t.applicationCache.status===t.applicationCache.UPDATEREADY&&s(),"serviceWorker"in navigator&&t.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope),e.update()}).catch(function(e){console.log("ServiceWorker registration failed: ",e)})}),r.$on("$routeChangeStart",function(r,t,a){if(null===t||void 0===t.access||!t.access.requiredLogin||o.isLogged||n.get("admin")){console.log("inside else");var s=n.get("token");"/"===e.path()&&s&&e.path("/dashboard")}else console.log("inside if"),o.isLogged=0,e.path("/")}),r.clearToken=function(){n.remove("token"),n.remove("admin"),delete r.admin,o.isLogged=!1,e.path("/login")},r.$on("TokenExpiredError",function(e,r){a.alert({message:r.message,class:"error"})}),r.admin=n.get("admin")}]),angular.module("app.routes",["ngRoute","angular-loading-bar"]).config(["$routeProvider","cfpLoadingBarProvider","$locationProvider",function(e,r,t){r.includeSpinner=!1,e.when("/",{controller:"authCtrl",controllerAs:"vm",templateUrl:"Admin/auth/views/login.html",access:{requiredLogin:!1}}).when("/dashboard",{controller:"dashboardCtrl",controllerAs:"vm",templateUrl:"Admin/dashboard/views/dashboard.html",access:{requiredLogin:!0}}).when("/profile",{controller:"profileCtrl",controllerAs:"vm",templateUrl:"Admin/profile/views/profile.html",access:{requiredLogin:!0}}).when("/users",{controller:"usersCtrl",controllerAs:"vm",templateUrl:"Admin/users/views/users.html",access:{requiredLogin:!0}}).when("/categories",{controller:"categoryCtrl",controllerAs:"vm",templateUrl:"Admin/categories/views/categories.html",access:{requiredLogin:!0}}).otherwise({redirectTo:"/"})}]),angular.module("app.factories").service("pouchDBSvr",["pouchDB","pouchDBDecorators",function(e,r){var t=e("AdminLTE");return t.find=r.qify(t.find),{get:function(e){return t.get(e)},find:function(e){return t.find({selector:e}).then(function(e){return e.docs}).catch(function(e){return e})},findAll:function(){return t.allDocs({include_docs:!0,attachments:!0}).then(function(e){return e}).catch(function(e){return e})},post:function(e){return t.post(e)},replicate:function(){t.replicate.to("http://localhost/adminlte").$promise.then(null,null,function(e){console.log("replication status",e)}).then(function(e){console.log("replication resolved with",e)}).catch(function(e){console.error("replication failed with",e)}).finally(function(){console.log("done")})},change:function(){t.changes({since:"now",include_docs:!0}).on("change",function(e){console.log(e)}).on("complete",function(e){console.log(e)}).on("error",function(e){console.log(e)})}}}]),angular.module("app.factories").factory("RestSvr",["$http",function(e){return{search:function(r,t,n){var o=angular.isUndefined(n)?"":"?"+n;return e.post(r+o,t).then(function(e){return{records:e.data.data.records,paging:e.data.data.paging}},function(e){return{errors:e.data.errors}})},login:function(r,t){return e.post(r,t).then(function(e){return{result:e.data.success,user:e.data.user,token:e.data.token}},function(e){return{errors:e.data.errors}})},paginate:function(r,t,n,o){var a=angular.isUndefined(t)?"":t,s=angular.isUndefined(n)?"":"?"+n;return e.get(r+a+s,o).then(function(e){return{records:e.data.data.records,paging:e.data.data.paging,group:e.data.data.group}})},get:function(r,t){var n=angular.isUndefined(t)?null:t;return e.get(r,n).then(function(e){return{record:e.data.data.record}})},getById:function(r,t){return e.get(r+t).then(function(e){return{record:e.data}})},post:function(r,t){return e.post(r,t).then(function(e){return{result:e.data.data.success,message:e.data.data.message,data:e.data.data.record}},function(e){return{errors:e.data.errors}})},put:function(r,t,n,o){var a=angular.isUndefined(o)?null:o;return e.put(r+t,n,a).then(function(e){return{result:e.data.success,message:e.data.message,data:e.data.record}},function(e){return{errors:e.data.errors}})},delete:function(r,t){return e.delete(r+t).then(function(e){return{message:e.data.data.message,result:e.data.data.success}},function(e){return{errors:e.data.errors}})}}}]),angular.module("app.factories").factory("toastService",["$mdToast","$timeout",function(e,r){return{alert:function(t){e.hide(),r(function(){var r=e.simple().textContent(t.message).position("bottom right").toastClass("fixed "+t.class).action("x").hideDelay(3e3);e.show(r).then(function(r){"ok"==r&&e.hide()})},1e3)}}}]),angular.module("app.directives").directive("setHeight",["$window",function(e){return{restrict:"A",link:function(r,t,n){t.css("min-height",e.innerHeight-50+"px")}}}]),angular.module("app.factories").factory("AuthSrv",function(){var e={isLogged:!1};return e}),angular.module("app.controllers").controller("authCtrl",["$scope","$location","localStorageService","RestSvr","toastService","AuthSrv","$rootScope",function(e,r,t,n,o,a,s){function i(e){e&&n.login("admin/login",c.admin).then(function(e){e.errors?o.alert({message:e.errors.message,class:"error"}):(t.set("token",e.token),t.set("admin",e.user),a.isLogged=!0,s.admin=t.get("admin"),r.path("/dashboard"))})}var c=this;c.signin=i}]),angular.module("app.controllers").controller("dashboardCtrl",["pouchDBSvr",function(e){console.log("DashboardCrl")}]),angular.module("app.directives").directive("passwordVerify",passwordVerify),angular.module("app.controllers").controller("profileCtrl",["$scope","$location","localStorageService","RestSvr","toastService","$rootScope","$timeout",function(e,r,t,n,o,a,s){function i(e){e&&n.put("admin/profile/",l.admin._id,l.admin).then(function(e){e.errors?o.alert({message:e.errors.message,class:"error"}):(o.alert({message:e.message,class:"success"}),t.set("admin",e.data),a.admin=t.get("admin"))})}function c(e){if(e)return l.passwordDetails.new_password!==l.passwordDetails.confirm_password?void o.alert({message:"New password and confirm password are not same",class:"error"}):void n.put("admin/change_password/",l.admin._id,l.passwordDetails).then(function(e){e.errors?o.alert({message:e.errors.message,class:"error"}):(l.changePasswordForm.$setPristine(),l.changePasswordForm.$setUntouched(),s(function(){l.passwordDetails={}},1e3),o.alert({message:e.message,class:"success"}))})}var l=this;l.admin=t.get("admin"),l.update=i,l.changePassword=c}]),angular.module("app.controllers").controller("usersCtrl",["pouchDBSvr","$scope",function(e,r){function t(e){r.users=e.rows}r.selected=[],e.findAll().then(t)}]);